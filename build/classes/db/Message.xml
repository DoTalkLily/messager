<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.messager.dao.IMessageOperation">
    
	<resultMap type="Message" id="resultMessageList">
        <id column="message_id" property="messageId" />
        <result column="sender_id" property="senderId" />
        <result column="sender_nick" property="senderNick" />
        <result column="title" property="title" />
        <result column="content" property="content" />
    </resultMap>
    
    <select id="getMessageByID" parameterType="int" resultType="Message">
        select * from `message` where message_id = #{id}
    </select>
    
    <select id="getMessageList" parameterType="java.util.Map" resultType="Message">
        select * from `message` where receiver_id = #{userId}
		    <if test="senderId != null">
		         AND sender_id = #{senderId}
		    </if> 
		    <if test="status != null">
		         AND status = #{status}
		    </if>
		    <if test="senderNick != null">
		         AND sender_nick = #{senderNick}
		    </if>
		    <if test="messageType != null">
		         AND message_type = #{messageType}
		    </if>
		    <if test="begin != null and end != null">
		         AND send_date between ${begin} AND $(end)
		    </if>
		    <if test="page > 0 and offset > 0">
       		     AND limit #{page}, #{offset}
   			</if>
    </select>
    
    <insert id="saveMessage" parameterType="Message" 
        useGeneratedKeys="true" keyProperty="messageId"> 
        insert into message(sender_id,receiver_id,sender_nick,title,content,send_date,message_type,status)  
             values(#{senderId},#{receiverId},#{senderNick},#{title},#{content},#{sendDate},#{messageType},#{status})  
    </insert>
</mapper>